<!DOCTYPE html>
<html>
<head>
    <title>Community Hub | Wiki Mode</title>
    <style>
        body { font-family: sans-serif; padding: 30px; max-width: 800px; margin: auto; line-height: 1.6; }
        .card { border: 1px solid #ddd; padding: 20px; border-radius: 8px; margin-bottom: 15px; background: #fff; }
        .btn { background: #0969da; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-weight: bold; }
        /* The Inline Editor Modal */
        #editor { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 100; }
        .editor-content { background: white; margin: 5% auto; padding: 20px; width: 80%; border-radius: 8px; }
        textarea { width: 100%; height: 300px; font-family: monospace; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>üè° Community Source of Truth</h1>
    <p>Click "Edit" to suggest changes. Your update will be submitted for admin review.</p>
    
    <div id="directory">Loading...</div>

    <div id="editor">
        <div class="editor-content">
            <h3 id="edit-title">Editing Area</h3>
            <textarea id="edit-text"></textarea><br>
            <button onclick="submitChange()" class="btn">Submit for Review</button>
            <button onclick="document.getElementById('editor').style.display='none'" style="background:none; color:red; border:none; cursor:pointer;">Cancel</button>
            <p id="status-msg" style="font-size: 0.8em; margin-top: 10px;"></p>
        </div>
    </div>

    <script>
        const USER = 'dekumar2-lab';
        const REPO = 'community-hub';
        let currentFile = "";

        async function fetchClusters() {
            const res = await fetch(`https://api.github.com/repos/${USER}/${REPO}/contents/clusters`);
            const files = await res.json();
            const container = document.getElementById('directory');
            container.innerHTML = '';
            files.forEach(file => {
                if(file.name.endsWith('.md')) {
                    const card = document.createElement('div');
                    card.className = 'card';
                    card.innerHTML = `
                        <button onclick="openEditor('${file.name}')" style="float:right">Edit Inline</button>
                        <h3>${file.name.replace('.md', '').toUpperCase()}</h3>
                    `;
                    container.appendChild(card);
                }
            });
        }

        async function openEditor(filename) {
            currentFile = filename;
            const res = await fetch(`https://raw.githubusercontent.com/${USER}/${REPO}/master/clusters/${filename}`);
            const content = await res.text();
            document.getElementById('edit-text').value = content;
            document.getElementById('edit-title').innerText = "Editing: " + filename;
            document.getElementById('editor').style.display = 'block';
        }

        function submitChange() {
            const newContent = document.getElementById('edit-text').value;
            const msg = document.getElementById('status-msg');
            msg.innerText = "Submitting to GitHub Actions...";

            // Because GitHub is strict, we use 'repository_dispatch'
            // This requires an automation bridge like Pipedream or a small backend.
            alert("To finalize the 'Save' button without moving to GitHub, we need to connect a tiny Automation Bridge.");
        }

        fetchClusters();
    </script>
</body>
</html>
